#!/usr/bin/env python
from pylab import *
import atpy 
 


infile = '/home/share/research/luminosityfunction/testLF.fits'
lf=atpy.Table(infile)

figure()
t=hist(lf.logL, bins=100)
clf()
print t
#split t
#bins =xvalues
bins = t[1]
yvalue = t[0]

bincenters=[]
for x in range(len(yvalue)):
    bincenters.append((bins[x]+bins[x+1])/2)

#print bincenters
#print len(bincenters)            
yerror =(sqrt(t[0]))
yplot = (log10(yvalue))
plot(bincenters, yplot,'bo')
ylabel('log(N)')
xlabel('log(L)')

yerrdown=log10(yvalue)-log10(yvalue-yerror)
yerrdown2=[]
lf2=[]
for x in range(len(yerrdown)):
    if math.isnan(yerrdown[x]):
        print 'hey'
    elif yerrdown[x] > 1*10**25:
        print 'hey'
    else:
        yerrdown2.append(yerrdown[x])
        lf2.append(lf[x])

yerrup=log10(yvalue+yerror)-log10(yvalue)
yerrup2=[]
lf2=[]
for x in range(len(yerrup)):
    if math.isnan(yerrup[x]):
        print 'hey'
    elif yerrup[x] > 1*10**25:
        print 'hey'
    else:
        yerrup2.append(yerrup[x])
        lf2.append(lf[x])

yerrboth=zip(yerrdown2,yerrup2)
yerrboth=transpose(yerrboth)
errorbar(bincenters, yplot, yerr=yerrboth)









#ax=gca()
#ax.set_yscale('log')
#ax=gca()
#ax.set_xscale('log')
#Lvalues = linspace(-2, 1, 100)
#Llinear = 10**(Lvalues)
#schect = 55*(Llinear**(-0.25))*exp(-Llinear)
#plot(Lvalues, log10(schect))


alphabest=0.
logphistarbest=0.
loglstarbest=0.
chisqmin=1.*10**7

for alpha in range(-2,2,1):
    for loglstar in range(-1,1,1):
        for logphistar in range(-3,3,1):
            yfit = (log(10)**(logphistar))*((yvalue/10**loglstar)**alpha+1)*exp(yvalue/10**loglstar)
            chisq = sum(((yfit-yvalue)**2)/yerrboth**2)
            if chisq < chisqmin:
                alphabest = alpha
                loglstarbest = loglstar
                logphistarbest = logphistar




			
        
